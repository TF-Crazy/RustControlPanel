<UserControl x:Class="RustControlPanel.Views.Components.TopBar"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="clr-namespace:RustControlPanel.Views.Controls"
             Height="56"
             DataContext="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext}">

    <Border Background="{DynamicResource ThemeTopBar}" BorderBrush="{DynamicResource ThemeCardBorder}" BorderThickness="0,0,0,1">
        <Grid Margin="12,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <ScrollViewer Grid.Column="0" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                <StackPanel Orientation="Horizontal">
                    
                    <!-- Players -->
                    <Border Background="{DynamicResource ThemeCard}" BorderBrush="{DynamicResource ThemeCardBorder}" BorderThickness="1" CornerRadius="4" Width="90" Height="40" Padding="10,0" Margin="0,0,8,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Path Grid.Column="0" Data="M16,13C15.71,13 15.38,13 15.03,13.05C16.19,13.89 17,15 17,16.5V19H23V16.5C23,14.17 18.33,13 16,13M8,13C5.67,13 1,14.17 1,16.5V19H15V16.5C15,14.17 10.33,13 8,13M8,11A3,3 0 0,0 11,8A3,3 0 0,0 8,5A3,3 0 0,0 5,8A3,3 0 0,0 8,11M16,11A3,3 0 0,0 19,8A3,3 0 0,0 16,5A3,3 0 0,0 13,8A3,3 0 0,0 16,11Z" Fill="{DynamicResource ThemeAccent}" Stretch="Uniform" Width="14" Height="14" VerticalAlignment="Center"/>
                            <StackPanel Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Center" Orientation="Horizontal">
                                <TextBlock Text="{Binding PlayerCount, FallbackValue=0}" Foreground="{DynamicResource ThemeAccent}" FontWeight="SemiBold" FontSize="12" VerticalAlignment="Center"/>
                                <TextBlock Text="/" Foreground="{DynamicResource ThemeTextMuted}" FontSize="12" Margin="2,0" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding MaxPlayers, FallbackValue=50}" Foreground="{DynamicResource ThemeTextSecondary}" FontSize="12" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Queue -->
                    <Border Background="{DynamicResource ThemeCard}" BorderBrush="{DynamicResource ThemeCardBorder}" BorderThickness="1" CornerRadius="4" Width="80" Height="40" Padding="10,0" Margin="0,0,8,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Path Grid.Column="0" Data="M12,3L2,12H5V20H19V12H22L12,3M12,8.75A2.25,2.25 0 0,1 14.25,11A2.25,2.25 0 0,1 12,13.25A2.25,2.25 0 0,1 9.75,11A2.25,2.25 0 0,1 12,8.75M12,15C13.5,15 16.5,15.75 16.5,17.25V18H7.5V17.25C7.5,15.75 10.5,15 12,15Z" Fill="{DynamicResource ThemeAccentWarning}" Stretch="Uniform" Width="14" Height="14" VerticalAlignment="Center"/>
                            <TextBlock Grid.Column="1" Text="{Binding QueueCount, FallbackValue=0}" HorizontalAlignment="Right" VerticalAlignment="Center" FontSize="12" FontWeight="SemiBold" Foreground="{DynamicResource ThemeAccentWarning}"/>
                        </Grid>
                    </Border>

                    <!-- Joining -->
                    <Border Background="{DynamicResource ThemeCard}" BorderBrush="{DynamicResource ThemeCardBorder}" BorderThickness="1" CornerRadius="4" Width="80" Height="40" Padding="10,0" Margin="0,0,8,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Path Grid.Column="0" Data="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" Fill="{DynamicResource ThemeAccentSuccess}" Stretch="Uniform" Width="14" Height="14" VerticalAlignment="Center"/>
                            <TextBlock Grid.Column="1" Text="{Binding JoiningCount, FallbackValue=0}" HorizontalAlignment="Right" VerticalAlignment="Center" FontSize="12" FontWeight="SemiBold" Foreground="{DynamicResource ThemeAccentSuccess}"/>
                        </Grid>
                    </Border>

                    <!-- FPS -->
                    <Border Background="{DynamicResource ThemeCard}" BorderBrush="{DynamicResource ThemeCardBorder}" BorderThickness="1" CornerRadius="4" Width="75" Height="40" Padding="10,0" Margin="0,0,8,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Path Grid.Column="0" Data="M7,2V13H10V22L17,10H13L17,2H7Z" Fill="{DynamicResource ThemeAccentSuccess}" Stretch="Uniform" Width="14" Height="14" VerticalAlignment="Center"/>
                            <TextBlock Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Center" FontSize="12" FontWeight="SemiBold" Foreground="{DynamicResource ThemeAccentSuccess}">
                                <Run Text="{Binding ServerFps, StringFormat={}{0:F0}, FallbackValue=60}"/><Run Text=" FPS" FontSize="10" Foreground="{DynamicResource ThemeTextMuted}"/>
                            </TextBlock>
                        </Grid>
                    </Border>

                    <!-- FPS Chart -->
                    <Border Background="{DynamicResource ThemeCard}" BorderBrush="{DynamicResource ThemeCardBorder}" BorderThickness="1" CornerRadius="4" Width="280" Height="40" Margin="0,0,8,0">
                        <controls:FpsChart x:Name="FpsChartControl"/>
                    </Border>

                    <!-- Entity Time -->
                    <Border Background="{DynamicResource ThemeCard}" BorderBrush="{DynamicResource ThemeCardBorder}" BorderThickness="1" CornerRadius="4" Width="80" Height="40" Padding="10,0" Margin="0,0,8,0">
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="ENTITY" FontSize="9" FontWeight="SemiBold" Foreground="{DynamicResource ThemeTextMuted}"/>
                            <TextBlock FontSize="12" FontWeight="Medium" Foreground="{DynamicResource ThemeText}">
                                <Run Text="{Binding EntityTime, StringFormat={}{0:F1}, FallbackValue=0.0}"/><Run Text="ms" FontSize="10" Foreground="{DynamicResource ThemeTextMuted}"/>
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Game Time -->
                    <Border Background="{DynamicResource ThemeCard}" BorderBrush="{DynamicResource ThemeCardBorder}" BorderThickness="1" CornerRadius="4" Width="80" Height="40" Padding="10,0" Margin="0,0,8,0">
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="GAME" FontSize="9" FontWeight="SemiBold" Foreground="{DynamicResource ThemeTextMuted}"/>
                            <TextBlock Text="{Binding GameTime, FallbackValue=00:00}" FontSize="12" FontWeight="Medium" Foreground="{DynamicResource ThemeText}"/>
                        </StackPanel>
                    </Border>

                    <!-- Uptime -->
                    <Border Background="{DynamicResource ThemeCard}" BorderBrush="{DynamicResource ThemeCardBorder}" BorderThickness="1" CornerRadius="4" Width="100" Height="40" Padding="10,0" Margin="0,0,8,0">
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="UPTIME" FontSize="9" FontWeight="SemiBold" Foreground="{DynamicResource ThemeTextMuted}"/>
                            <TextBlock Text="{Binding Uptime, FallbackValue=0d 0h 0m}" FontSize="12" FontWeight="Medium" Foreground="{DynamicResource ThemeText}"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>

            <!-- Actions -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="8,0,0,0">
                <!-- Debug Button -->
                <Button Command="{Binding ToggleDebugCommand}" Width="32" Height="32" Margin="0,0,8,0" Background="Transparent" BorderThickness="0" Cursor="Hand">
                    <Path Data="M12,2C11.5,2 11,2.19 10.59,2.59L2.59,10.59C1.8,11.37 1.8,12.63 2.59,13.41L10.59,21.41C11.37,22.2 12.63,22.2 13.41,21.41L21.41,13.41C22.2,12.63 22.2,11.37 21.41,10.59L13.41,2.59C13,2.19 12.5,2 12,2M11,7H13V13H11V7M11,15H13V17H11V15Z" Fill="{DynamicResource ThemeAccentWarning}" Stretch="Uniform" Width="16" Height="16"/>
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#20F59E0B"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <!-- Disconnect -->
                <Button Command="{Binding DisconnectCommand}" Width="32" Height="32" Background="Transparent" BorderThickness="0" Cursor="Hand">
                    <Path Data="M16,17V14H9V10H16V7L21,12L16,17M14,2A2,2 0 0,1 16,4V6H14V4H5V20H14V18H16V20A2,2 0 0,1 14,22H5A2,2 0 0,1 3,20V4A2,2 0 0,1 5,2H14Z" Fill="{DynamicResource ThemeAccentDanger}" Stretch="Uniform" Width="16" Height="16"/>
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#30EF4444"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
